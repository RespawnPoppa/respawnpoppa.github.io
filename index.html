<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA III</title>
    <style>
        canvas {
            background-color: white;
            border-color: black;
            border-style: solid;
        }

        body {
            background-color: black;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<canvas id="myCanvas" width="1158" height="808"></canvas>
<script>
    var canvas = document.getElementById("myCanvas");
    var ctx = canvas.getContext('2d');

    // Función para solicitar la animación
    window.requestAnimationFrame = (function () {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            function (callback) {
                window.setTimeout(callback, 17);
            };
    }());

    // Cargar la imagen de fondo
    const imagenFondo = new Image();
    imagenFondo.src = "img/map.png";
    imagenFondo.onload = () => {
        ctx.drawImage(imagenFondo, 0, 0, canvas.width, canvas.height);
    };

    // Declaraciones generales
    var tx = 0, ty = 0;
    var moving = false;
    var x = 516, y = 564, dir = 0, speed = 6;

    // Variables para el uso de los sprite imágenes del jugador
    var playerSprites = {
        up: new Image(),
        down: new Image(),
        left: new Image(),
        right: new Image(),
        stop: new Image()
    };
    playerSprites.up.src = "img/playerRun3.png";
    playerSprites.down.src = "img/playerRun4.png";
    playerSprites.left.src = "img/playerRun2.png";
    playerSprites.right.src = "img/playerRun1.png";
    playerSprites.stop.src = "img/spriteParado.png";

    // Declaraciones de variables para el uso de los sprite imágenes de los autos
    var auto = new Image();
    auto.src = "img/autoI.png";
    var auto2 = new Image();
    auto2.src = "img/autoII.png";
    var squareX = 0;
    var squareSpeed = 8;
    var canvasWidth = canvas.width;
    var anchoAutoI = 190;
    var altoAutoI = 80;

    // Definición de valores de colisión para los autos
    var squareSize = 50;
    var positionAutoY = canvas.height / 1.90 - squareSize / 1.90;
    var positionAutoY2 = canvas.height / 2.4 - altoAutoI / 2.4;
    var squareX2 = canvasWidth;

    // Controles del jugador
    document.addEventListener("keydown", (e) => {
        if (!moving) {
            moving = true;
            switch (e.keyCode) {
                case 87: 
                    dir = 1; 
                    break;
                case 83: 
                    dir = 2; 
                    break;
                case 68: 
                    dir = 3; 
                    break;
                case 65: 
                    dir = 4; 
                    break;
            }
        }
    });

    document.addEventListener("keyup", (e) => {
        moving = false;
    });

    function update() {
        if (moving) {
            if (dir == 1 && y > 0) {
                y -= speed;
            }
            if (dir == 2 && y + 50 < canvas.height) {
                y += speed;
            }
            if (dir == 3 && x + 50 < canvas.width) {
                x += speed;
            }
            if (dir == 4 && x > 0) {
                x -= speed;
            }
        }

        // Colisión con el objetivo (carro1)
        if (
            x < squareX + squareSize &&
            x + 50 > squareX &&
            y < positionAutoY + squareSize &&
            y + 50 > positionAutoY
        ) {
            console.log("Colisión con el objetivo (carro1)");
            x = 516;
            y = 564;
        }

        // Colisión con el objetivo (carro2)
        if (
            x < squareX2 + squareSize &&
            x + 50 > squareX2 &&
            y < positionAutoY2 + squareSize &&
            y + 50 > positionAutoY2
        ) {
            console.log("Colisión con el objetivo (carro2)");
            x = 516;
            y = 564;
        }

        squareX += squareSpeed;

        if (squareX > canvasWidth) {
            squareX = -squareSize;
        }

        moveAuto2();
        drawScene();
        window.requestAnimationFrame(update);
    }

    
    function drawScene() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.drawImage(imagenFondo, 0, 0, canvas.width, canvas.height);

        ctx.drawImage(auto, squareX, positionAutoY, anchoAutoI, altoAutoI);
        ctx.drawImage(auto2, squareX2, positionAutoY2, anchoAutoI, altoAutoI);

        switch (dir) {
            // Dibuja el sprite del jugador según la dirección
            case 1:
                ctx.drawImage(playerSprites.up, x, y, 50, 50);
                break;
            case 2:
                ctx.drawImage(playerSprites.down, x, y, 50, 50);
                break;
            case 3:
                ctx.drawImage(playerSprites.right, x, y, 50, 50);
                break;
            case 4:
                ctx.drawImage(playerSprites.left, x, y, 50, 50);
                break;
            default:
                ctx.drawImage(playerSprites.stop, x, y, 50, 50);
                break;
        }
    }

    function moveAuto2() {
        squareX2 -= squareSpeed; 
        if (squareX2 + anchoAutoI < 0) {
            squareX2 = canvasWidth;
        }
    }

    update();
</script>
</body>
</html>
