<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA III</title>
    <style>
        canvas {
            background-color: white;
            border-color: black;
            border-style: solid;
        }

        body {
            background-color: black;
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<!-- Jose Manuel Benitez Perez
Ingeniero en Desarrollo de Software
Programación Avanzada Internet
Semestre VII, T.V
-->
<canvas id="myCanvas" width="1158" height="808"></canvas>
<script>
    var canvas = document.getElementById("myCanvas")
    var ctx = canvas.getContext('2d')

    window.requestAnimationFrame = (function () {
        return window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            function (callback) {
                window.setTimeout(callback, 17);
            };
    }());

    //Imagen de fondo
    const imagenFondo = new Image();
    imagenFondo.src = "img/map.png"
    imagenFondo.onload = () => {
        ctx.drawImage(imagenFondo, 0, 0, canvas.width, canvas.height);

    };

    //Declaraciones de variables
    var canvasSize = 500;
    var cw = canvas.width, ch = canvas.height;
    var tx = 0, ty = 0;
    var wx = 120, wy = 320;
    var moving = false;
    let image = new Image();

    // Declaración y de implementación imagenes del jugador Sprite
    var x = 516, y = 564, dir = 0, speed = 2;
    var playerSprites = {
        up: new Image(),
        down: new Image(),
        left: new Image(),
        right: new Image(),
        stop: new Image()
    };
    playerSprites.up.src = "img/playerRun3.png";
    playerSprites.down.src = "img/playerRun4.png";
    playerSprites.left.src = "img/playerRun2.png";
    playerSprites.right.src = "img/playerRun1.png";
    playerSprites.stop.src = "img/spriteParado.png"

    //Declaración y de implementación imagenes los autos
    var auto = new Image();
    auto.src = "img/autoI.png";
    var squareSize = 50;
    var positionAutoX = 516// Cambia el valor de positionAutoY a la posición vertical deseada
    var squareX = 0; // Posición de la figura cuadrada
    var squareSpeed = 8; // Velocidad de la figura cuadrada
    var canvasWidth = canvas.width;
    var anchoAutoI = 190; // Cambia este valor al ancho deseado
    var altoAutoI = 80; // Cambia este valor al alto deseado

    // Función para mover el jugador
    document.addEventListener("keydown", (e) => {
        if (!moving) {
            moving = true;
            switch (e.keyCode) {
                case 87: // W
                    dir = 1;
                    break;
                case 83: // S
                    dir = 2;
                    break;
                case 68: // D
                    dir = 3;
                    break;
                case 65: // A
                    dir = 4;
                    break;
            }
        }
    });
    document.addEventListener("keyup", (e) => {
        moving = false;
    });

    // Función para actualizar el juego y los efectos de colisión o actualización fotograma
    function update() {
        if (moving) {
            if (dir == 1 && y > 0) {
                y -= speed;
            }
            if (dir == 2 && y + 50 < ch) {
                y += speed;
            }
            if (dir == 3 && x + 50 < cw) {
                x += speed;
            }
            if (dir == 4 && x > 0) {
                x -= speed;
            }
        }

        // Colisión con el objetivo
        if (x < tx + 20 && x + 50 > tx && y < ty + 20 && y + 50 > ty) {
            console.log("Colisión con el objetivo");
            tx = randomInteger(cw);
            ty = randomInteger(ch);
        }

        squareX += squareSpeed;

        if (squareX > canvasWidth) {
            squareX = -squareSize;
        }
        drawScene();
        window.requestAnimationFrame(update);
    }

    // Función para dibujar la escena y la pintura del juego
    function drawScene() {
        //Fondo del escenario
        ctx.clearRect(0, 0, cw, ch);
        ctx.drawImage(imagenFondo, 0, 0, canvas.width, canvas.height);

        
            // Restablece la posición predeterminada del auto cuando no se mueve a la izquierda
            positionAutoY = 400;
    

        ctx.drawImage(auto, squareX, positionAutoY, anchoAutoI, altoAutoI); // Ajusta la posición Y aquí

        // Dibuja el sprite del jugador según la dirección
        switch (dir) {
            case 1:
                ctx.drawImage(playerSprites.up, x, y, 50, 50);
                break;
            case 2:
                ctx.drawImage(playerSprites.down, x, y, 50, 50);
                break;
            case 3:
                ctx.drawImage(playerSprites.right, x, y, 50, 50);
                break;
            case 4:
                ctx.drawImage(playerSprites.left, x, y, 50, 50);
                break;
            default:
                ctx.drawImage(playerSprites.stop, x, y, 50, 50);
                break;
        }

    }

    // Para saber las direcciones con click mouse
    canvas.addEventListener("mousedown", function (event) {
        var x = event.layerX;
        var y = event.layerY;
        console.log("Coordenadas x:", x, "y:", y);
    });

    update();
</script>
</body>
</html>
